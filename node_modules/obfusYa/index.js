/**
 * Created by atom on 07.07.2016.
 */
/**
 * @param {Array} data – массив CSS классов
 */
module.exports = function (data) {

    var result = {},
        classCount = [],
        usageShortName = {},
        firstCharList = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ',
        OtherCharsList = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_';

    var i = -1;
    data.slice().sort().reduce(function (arr, res) {
        if (!arr.length || arr.length && arr[arr.length - 1] != res) {
            arr.push(res);
            classCount.push({className: res, count: 1});
            i++;
        }else {
            classCount[i].count++;
        }
        return arr;
    }, []);

    classCount = classCount.sort(function(min, max) {
        if(min.count < max.count) {
            return 1;
        } else {
            return -1;
        }
    });

    classCount.forEach(function(item, index) {
        if(i < firstCharList.length){
            result[item.className] = firstCharList[index];
        } else {
            result[item.className] = generateShortName(index);
        }
    });

    function generateShortName(index) {
        var shortName;
        shortName = firstCharList.charAt(Math.floor(Math.random()*firstCharList.length)) +
            OtherCharsList.charAt(Math.floor(Math.random() * OtherCharsList.length));
        if (index > 2500){
            shortName += OtherCharsList.charAt(Math.floor(Math.random() * OtherCharsList.length));
        }
        if (usageShortName[shortName]) {
            return generateShortName();
        }else {
            usageShortName[shortName] = true;
            return shortName;
        }
    }
    return result;
};